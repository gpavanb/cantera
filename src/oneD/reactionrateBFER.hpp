#include <cmath>
#include <iostream>
#include <vector>

std::vector<double> reactionrateBFER(double rho, double YF, double YO2,
                                     double YN2, double YH2O, double YCO, double YCO2, double T) {

  std::vector<double> H_F = { 0.0000000000e+00, 3.5584035020e+03, 1.4233772155e+04, 3.2025947057e+04, 5.6935013151e+04, 8.7500087477e+04, 1.2296448466e+05, 1.6268961234e+05, 2.0611387312e+05, 2.5271076628e+05, 3.0194747847e+05, 3.5329368864e+05, 4.0646016177e+05, 4.6127400486e+05, 5.1757466097e+05, 5.7521346376e+05, 6.3405292821e+05, 6.9396660540e+05, 7.5483847566e+05, 8.1656253884e+05, 8.7904231446e+05, 9.4219026770e+05, 1.0059277216e+06, 1.0701839351e+06, 1.1348960855e+06, 1.2000083052e+06, 1.2654715460e+06, 1.3312440229e+06, 1.3972878490e+06, 1.4635723837e+06, 1.5300711086e+06, 1.5967625006e+06, 1.6636265567e+06, 1.7306490690e+06, 1.7978177200e+06, 1.8651215896e+06, 1.9325533060e+06, 2.0001062370e+06, 2.0677755590e+06, 2.1355547087e+06, 2.2034413009e+06, 2.2714298133e+06, 2.3395147107e+06, 2.4076905117e+06, 2.4759499414e+06, 2.5442822314e+06, 2.6126762021e+06, 2.6811182635e+06, 2.7495893319e+06, 2.8180686528e+06, 2.8865315261e+06};    
  std::vector<double> S_F = { 0.0000000000e+00, 1.7018721435e+02, 3.4231308345e+02, 5.1045211056e+02, 5.8162605636e+02, 6.4962963814e+02, 7.1415767073e+02, 7.7531689155e+02, 8.3325055057e+02, 8.8810014517e+02, 9.3995436852e+02, 9.8887785365e+02, 1.0351277862e+03, 1.0789944031e+03, 1.1207109858e+03, 1.1604722405e+03, 1.1984426473e+03, 1.2347619983e+03, 1.2695531438e+03, 1.3029238346e+03, 1.3349697622e+03, 1.3657784074e+03, 1.3954280110e+03, 1.4239906054e+03, 1.4515313321e+03, 1.4781107842e+03, 1.5037854726e+03, 1.5286080714e+03, 1.5526260636e+03, 1.5758863014e+03, 1.5984297601e+03, 1.6202978941e+03, 1.6415279388e+03, 1.6621551433e+03, 1.6822135370e+03, 1.7017345602e+03, 1.7207490643e+03, 1.7392845031e+03, 1.7573678104e+03, 1.7750242202e+03, 1.7922781999e+03, 1.8091499570e+03, 1.8256618489e+03, 1.8418328634e+03, 1.8576800429e+03, 1.8732208271e+03, 1.8884702173e+03, 1.9034417765e+03, 1.9181483690e+03, 1.9326020776e+03, 1.9468124788e+03};

  std::vector<double> H_O2 = { 0.0000000000e+00, 2.9040000000e+03, 5.8150000000e+03, 8.7370000000e+03, 1.1708000000e+04, 1.4767000000e+04, 1.7927000000e+04, 2.1182000000e+04, 2.4518000000e+04, 2.7924000000e+04, 3.1386000000e+04, 3.4895000000e+04, 3.8444000000e+04, 4.2027000000e+04, 4.5640000000e+04, 4.9282000000e+04, 5.2949000000e+04, 5.6641000000e+04, 6.0356000000e+04, 6.4096000000e+04, 6.7858000000e+04, 7.1644000000e+04, 7.5452000000e+04, 7.9283000000e+04, 8.3136000000e+04, 8.7011000000e+04, 9.0907000000e+04, 9.4824000000e+04, 9.8762000000e+04, 1.0271900000e+05, 1.0669600000e+05, 1.1069200000e+05, 1.1470600000e+05, 1.1873700000e+05, 1.2278500000e+05, 1.2684800000e+05, 1.3092800000e+05, 1.3502200000e+05, 1.3913000000e+05, 1.4325200000e+05, 1.4738800000e+05, 1.5153700000e+05, 1.5569800000e+05, 1.5987100000e+05, 1.6405700000e+05, 1.6825500000e+05, 1.7246600000e+05, 1.7668800000e+05, 1.8092300000e+05, 1.8517100000e+05, 1.8943200000e+05};
  std::vector<double> S_O2 = { 0.0000000000e+00, 1.7330700000e+02, 1.9348500000e+02, 2.0532900000e+02, 2.1387100000e+02, 2.2069300000e+02, 2.2645100000e+02, 2.3146600000e+02, 2.3592100000e+02, 2.3993100000e+02, 2.4357800000e+02, 2.4692200000e+02, 2.5001000000e+02, 2.5287800000e+02, 2.5555600000e+02, 2.5806800000e+02, 2.6043400000e+02, 2.6267200000e+02, 2.6479600000e+02, 2.6681800000e+02, 2.6874800000e+02, 2.7059500000e+02, 2.7236600000e+02, 2.7406900000e+02, 2.7570900000e+02, 2.7729000000e+02, 2.7881900000e+02, 2.8029700000e+02, 2.8172900000e+02, 2.8311800000e+02, 2.8446600000e+02, 2.8577600000e+02, 2.8705000000e+02, 2.8829100000e+02, 2.8949900000e+02, 2.9067700000e+02, 2.9182600000e+02, 2.9294900000e+02, 2.9404400000e+02, 2.9511500000e+02, 2.9616200000e+02, 2.9718600000e+02, 2.9818900000e+02, 2.9917100000e+02, 3.0013300000e+02, 3.0107600000e+02, 3.0200200000e+02, 3.0291000000e+02, 3.0380100000e+02, 3.0467700000e+02, 3.0553800000e+02};

  std::vector<double> H_CO = { 0.0000000000e+00, 2.9020000000e+03, 5.8130000000e+03, 8.7250000000e+03, 1.1647000000e+04, 1.4602000000e+04, 1.7613000000e+04, 2.0694000000e+04, 2.3848000000e+04, 2.7072000000e+04, 3.0361000000e+04, 3.3706000000e+04, 3.7101000000e+04, 4.0539000000e+04, 4.4014000000e+04, 4.7521000000e+04, 5.1056000000e+04, 5.4616000000e+04, 5.8197000000e+04, 6.1797000000e+04, 6.5415000000e+04, 6.9047000000e+04, 7.2692000000e+04, 7.6350000000e+04, 8.0019000000e+04, 8.3698000000e+04, 8.7386000000e+04, 9.1082000000e+04, 9.4787000000e+04, 9.8498000000e+04, 1.0221700000e+05, 1.0594200000e+05, 1.0967200000e+05, 1.1340900000e+05, 1.1715100000e+05, 1.2089800000e+05, 1.2464900000e+05, 1.2840600000e+05, 1.3216700000e+05, 1.3593200000e+05, 1.3970200000e+05, 1.4347500000e+05, 1.4725300000e+05, 1.5103400000e+05, 1.5481900000e+05, 1.5860800000e+05, 1.6240000000e+05, 1.6619600000e+05, 1.6999500000e+05, 1.7379700000e+05, 1.7760300000e+05};
  std::vector<double> S_CO = { 0.0000000000e+00, 1.6585000000e+02, 1.8602500000e+02, 1.9783300000e+02, 2.0628300000e+02, 2.1283100000e+02, 2.1831900000e+02, 2.2306600000e+02, 2.2727700000e+02, 2.3107400000e+02, 2.3453800000e+02, 2.3772600000e+02, 2.4067900000e+02, 2.4343100000e+02, 2.4600600000e+02, 2.4842600000e+02, 2.5070700000e+02, 2.5286500000e+02, 2.5491200000e+02, 2.5685900000e+02, 2.5871400000e+02, 2.6048600000e+02, 2.6218200000e+02, 2.6380800000e+02, 2.6536900000e+02, 2.6687100000e+02, 2.6831800000e+02, 2.6971300000e+02, 2.7106000000e+02, 2.7236200000e+02, 2.7362300000e+02, 2.7484400000e+02, 2.7602900000e+02, 2.7717800000e+02, 2.7829500000e+02, 2.7938200000e+02, 2.8043800000e+02, 2.8146800000e+02, 2.8247100000e+02, 2.8344900000e+02, 2.8440300000e+02, 2.8533500000e+02, 2.8624500000e+02, 2.8713500000e+02, 2.8800500000e+02, 2.8885600000e+02, 2.8969000000e+02, 2.9050600000e+02, 2.9130600000e+02, 2.9209000000e+02, 2.9285900000e+02};

  std::vector<double> H_CO2 = { 0.0000000000e+00, 2.9080000000e+03, 5.9500000000e+03, 9.4330000000e+03, 1.3367000000e+04, 1.7669000000e+04, 2.2271000000e+04, 2.7118000000e+04, 3.2170000000e+04, 3.7394000000e+04, 4.2761000000e+04, 4.8248000000e+04, 5.3837000000e+04, 5.9512000000e+04, 6.5260000000e+04, 7.1069000000e+04, 7.6933000000e+04, 8.2844000000e+04, 8.8795000000e+04, 9.4783000000e+04, 1.0080300000e+05, 1.0685200000e+05, 1.1292600000e+05, 1.1902400000e+05, 1.2514300000e+05, 1.3128100000e+05, 1.3743700000e+05, 1.4361000000e+05, 1.4979700000e+05, 1.5600000000e+05, 1.6221600000e+05, 1.6844500000e+05, 1.7468500000e+05, 1.8093700000e+05, 1.8722700000e+05, 1.9347300000e+05, 1.9975700000e+05, 2.0605000000e+05, 2.1235300000e+05, 2.1866500000e+05, 2.2498600000e+05, 2.3131500000e+05, 2.3765400000e+05, 2.4400100000e+05, 2.5035500000e+05, 2.5671800000e+05, 2.6308900000e+05, 2.6946700000e+05, 2.7585300000e+05, 2.8224600000e+05, 2.8864700000e+05};
  std::vector<double> S_CO2 = { 0.0000000000e+00, 1.7900900000e+02, 1.9997500000e+02, 2.1402500000e+02, 2.2531400000e+02, 2.3490100000e+02, 2.4328300000e+02, 2.5075000000e+02, 2.5749400000e+02, 2.6364500000e+02, 2.6929900000e+02, 2.7452800000e+02, 2.7939000000e+02, 2.8393200000e+02, 2.8819100000e+02, 2.9219900000e+02, 2.9598300000e+02, 2.9956600000e+02, 3.0296800000e+02, 3.0620500000e+02, 3.0929300000e+02, 3.1224400000e+02, 3.1507000000e+02, 3.1778100000e+02, 3.2038500000e+02, 3.2289000000e+02, 3.2530500000e+02, 3.2763400000e+02, 3.2988500000e+02, 3.3206100000e+02, 3.3416900000e+02, 3.3621100000e+02, 3.3819200000e+02, 3.4011600000e+02, 3.4198600000e+02, 3.4380400000e+02, 3.4557400000e+02, 3.4729900000e+02, 3.4897900000e+02, 3.5061900000e+02, 3.5221900000e+02, 3.5378200000e+02, 3.5531000000e+02, 3.5680300000e+02, 3.5826400000e+02, 3.5969400000e+02, 3.6109400000e+02, 3.6246600000e+02, 3.6381000000e+02, 3.6512800000e+02, 3.6642200000e+02};

  std::vector<double> H_H2O = { 0.0000000000e+00, 3.2890000000e+03, 6.6220000000e+03, 9.9660000000e+03, 1.3356000000e+04, 1.6829000000e+04, 2.0405000000e+04, 2.4096000000e+04, 2.7906000000e+04, 3.1842000000e+04, 3.5904000000e+04, 4.0095000000e+04, 4.4410000000e+04, 4.8846000000e+04, 5.3397000000e+04, 5.8055000000e+04, 6.2812000000e+04, 6.7662000000e+04, 7.2597000000e+04, 7.7610000000e+04, 8.2694000000e+04, 8.7845000000e+04, 9.3057000000e+04, 9.8325000000e+04, 1.0364500000e+05, 1.0901200000e+05, 1.1442400000e+05, 1.1987700000e+05, 1.2536800000e+05, 1.3089400000e+05, 1.3645300000e+05, 1.4204300000e+05, 1.4766100000e+05, 1.5330700000e+05, 1.5897700000e+05, 1.6467200000e+05, 1.7038900000e+05, 1.7612600000e+05, 1.8188400000e+05, 1.8766100000e+05, 1.9345600000e+05, 1.9926700000e+05, 2.0509500000e+05, 2.1093800000e+05, 2.1679600000e+05, 2.2266800000e+05, 2.2855400000e+05, 2.3445200000e+05, 2.4036200000e+05, 2.4628400000e+05, 2.5221700000e+05};
  std::vector<double> S_H2O = { 0.0000000000e+00, 1.5238800000e+02, 1.7548500000e+02, 1.8904200000e+02, 1.9878800000e+02, 2.0653400000e+02, 2.1305200000e+02, 2.1873900000e+02, 2.2382500000e+02, 2.2845900000e+02, 2.3273800000e+02, 2.3673100000e+02, 2.4048500000e+02, 2.4403500000e+02, 2.4740700000e+02, 2.5062000000e+02, 2.5369000000e+02, 2.5663000000e+02, 2.5945100000e+02, 2.6216100000e+02, 2.6476900000e+02, 2.6728200000e+02, 2.6970600000e+02, 2.7204800000e+02, 2.7431200000e+02, 2.7650300000e+02, 2.7862500000e+02, 2.8068300000e+02, 2.8268000000e+02, 2.8461900000e+02, 2.8650400000e+02, 2.8833700000e+02, 2.9012000000e+02, 2.9185800000e+02, 2.9355000000e+02, 2.9520100000e+02, 2.9681200000e+02, 2.9838400000e+02, 2.9991900000e+02, 3.0142000000e+02, 3.0288700000e+02, 3.0432200000e+02, 3.0572600000e+02, 3.0710100000e+02, 3.0844800000e+02, 3.0976700000e+02, 3.1106100000e+02, 3.1232900000e+02, 3.1357400000e+02, 3.1479500000e+02, 3.1599300000e+02};

  std::vector<double> H_N2 = { 0.0000000000e+00, 2.9020000000e+03, 5.8130000000e+03, 8.7240000000e+03, 1.1641000000e+04, 1.4581000000e+04, 1.7564000000e+04, 2.0607000000e+04, 2.3716000000e+04, 2.6893000000e+04, 3.0133000000e+04, 3.3430000000e+04, 3.6779000000e+04, 4.0173000000e+04, 4.3606000000e+04, 4.7075000000e+04, 5.0574000000e+04, 5.4099000000e+04, 5.7648000000e+04, 6.1218000000e+04, 6.4807000000e+04, 6.8412000000e+04, 7.2031000000e+04, 7.5665000000e+04, 7.9310000000e+04, 8.2966000000e+04, 8.6633000000e+04, 9.0309000000e+04, 9.3993000000e+04, 9.7685000000e+04, 1.0138500000e+05, 1.0509100000e+05, 1.0880400000e+05, 1.1252200000e+05, 1.1624700000e+05, 1.1997600000e+05, 1.2371100000e+05, 1.2745100000e+05, 1.3119500000e+05, 1.3494400000e+05, 1.3869700000e+05, 1.4245400000e+05, 1.4621500000e+05, 1.4997900000e+05, 1.5374800000e+05, 1.5752000000e+05, 1.6129500000e+05, 1.6507500000e+05, 1.6885700000e+05, 1.7264300000e+05, 1.7643300000e+05};
  std::vector<double> S_N2 = { 0.0000000000e+00, 1.5981100000e+02, 1.7998500000e+02, 1.9178900000e+02, 2.0018100000e+02, 2.0673900000e+02, 2.1217600000e+02, 2.1686600000e+02, 2.2101700000e+02, 2.2475700000e+02, 2.2817000000e+02, 2.3131300000e+02, 2.3422600000e+02, 2.3694300000e+02, 2.3948700000e+02, 2.4188000000e+02, 2.4413800000e+02, 2.4627500000e+02, 2.4830400000e+02, 2.5023400000e+02, 2.5207400000e+02, 2.5383300000e+02, 2.5551700000e+02, 2.5713200000e+02, 2.5868400000e+02, 2.6017600000e+02, 2.6161400000e+02, 2.6300100000e+02, 2.6434100000e+02, 2.6563700000e+02, 2.6689100000e+02, 2.6810600000e+02, 2.6928500000e+02, 2.7042900000e+02, 2.7154100000e+02, 2.7262200000e+02, 2.7367500000e+02, 2.7469900000e+02, 2.7569800000e+02, 2.7667100000e+02, 2.7762200000e+02, 2.7854900000e+02, 2.7945600000e+02, 2.8034100000e+02, 2.8120800000e+02, 2.8205600000e+02, 2.8288500000e+02, 2.8369800000e+02, 2.8449400000e+02, 2.8527500000e+02, 2.8604100000e+02};

  // Define required variables
  double P0 = 1e5;
  double rgas = 8.3114;
  double R = 8.3144; // Whatever   

  double WF = 0.14;

  double A1 = 1.596209851975100e+09;
  double A2 = 4.5e+07;
  double B1 = 0.29;
  double B2 = 1.5e-04;
  double C1 = 7.1;
  double C2 = 0.035;

  double Ea1 = 173636;
  double Ea2 = 83680;

  double phi01 = 1.173;
  double phi02 = 1.146;
  double phi11 = 1.2;
  double phi12 = 1.2;
  double phi21 = 1.8;
  double phi22 = 1.215;
  double phi32 = 1.32;

  double sigma01 = 0.04;
  double sigma02 = 0.045;
  double sigma11 = 0.02;
  double sigma12 = 0.04;
  double sigma21 = 0.18;
  double sigma22 = 0.03;
  double sigma32 = 0.09;

  double hform_F = -1.4136780378e+05;
  double hform_O2 = 0.0;
  double hform_CO = -113810.0;
  double hform_CO2 = -393151.0;
  double hform_H2O = -238922.0;
  double hform_N2 = 0.0; 

////
// Done with definitions
////

  // -1 to comply with C++
  size_t indT = std::min(int(std::floor(T/100)) + 1, 50) - 1;

  double factor2 = (T - 100*(indT-1))/100;
  double factor1 = (100*indT - T)/100;

  double hk_F = factor1*H_F[indT] + factor2*H_F[indT + 1];
  double sk_F = factor1*S_F[indT] + factor2*S_F[indT + 1];

  double hk_O2 = factor1*H_O2[indT] + factor2*H_O2[indT + 1];
  double sk_O2 = factor1*S_O2[indT] + factor2*S_O2[indT + 1];

  double hk_CO = factor1*H_CO[indT] + factor2*H_CO[indT + 1];
  double sk_CO = factor1*S_CO[indT] + factor2*S_CO[indT + 1];

  double hk_CO2 = factor1*H_CO2[indT] + factor2*H_CO2[indT + 1];
  double sk_CO2 = factor1*S_CO2[indT] + factor2*S_CO2[indT + 1];

  double hk_H2O = factor1*H_H2O[indT] + factor2*H_H2O[indT + 1];
  double sk_H2O = factor1*S_H2O[indT] + factor2*S_H2O[indT + 1];

  double hk_N2 = factor1*H_N2[indT] + factor2*H_N2[indT + 1];
  double sk_N2 = factor1*S_N2[indT] + factor2*S_N2[indT + 1];

  double Yz = 10*YF/WF*0.012 + YCO2/0.044*0.012 + YCO/0.028*0.012;
  double zbene = Yz*WF/0.012/10;
  double phiz = zbene/(1-zbene) * ((10 + 22/4) * 0.032/0.14/0.23);

  double C_F = rho*YF/WF;
  double C_O2 = rho*YO2/0.032;
  double C_CO2 = rho*YCO2/0.044;
  double C_CO = rho*YCO/0.028;

  double pea_f1 =  2./((1+tanh((phi01-phiz)/sigma01)) + B1*(1+tanh((phiz-phi11)/sigma11))  + C1*(1+tanh((phiz-phi21)/sigma21)));
  double pea_f2 = 0.5*((1+tanh((phi02-phiz)/sigma02)) + B2*(1+tanh((phiz-phi12)/sigma12)) + 
                  C2*(1+tanh((phiz-phi22)/sigma22))*(1+tanh((phi32-phiz)/sigma32)));
 
  double kf1 = A1*pea_f1*exp(-Ea1/R/T);
  double kf2 = A2*pea_f2*exp(-Ea2/R/T);

  double kr1 = 0;
  double kr2 = 0;

  double DeltaHr = -0.5*(hk_O2+hform_O2)*0.032-1.0*(hk_CO+hform_CO)*0.028+1.0*(hk_CO2+hform_CO2)*0.044; 
  double DeltaSr = -0.5*(sk_O2)*0.032-1.0*(sk_CO)*0.028+1.0*(sk_CO2)*0.044;

  double Keq = DeltaSr/rgas - DeltaHr/(rgas*T);
  Keq = std::exp( Keq );
  kr2 = kf2 / (Keq * pow(P0/(rgas*T), -0.5));
  std::cout << Keq << std::endl;

  double rrate1 = kf1 * pow(C_F, 0.55) * pow(C_O2, 0.9);
  double rrate2 = kf2 * pow(C_O2, 0.5) * C_CO;
  double rrate2_r = kr2 * C_CO2;

  // Load the vector
  std::vector<double> rates(6);
  // Fuel
  rates[0] = -1.0*WF*rrate1;
  // Oxygen
  rates[1] = -10 * 0.032 * rrate1 - 0.5 * 0.032 * (rrate2 - rrate2_r);
  // CO
  rates[2] = 10 * 0.028 * rrate1 - 1.0 * 0.028 * (rrate2 - rrate2_r);
  // CO2
  rates[3] = 1.0 * 0.044 * (rrate2 - rrate2_r);
  // H2O
  rates[4] = 10 * 0.018 * rrate1;
  // T
  rates[5] = -(hk_F+hform_F)/WF*rates[0]-(hk_O2+hform_O2)/0.032*rates[1]-(hk_CO+hform_CO)/0.028*rates[2]
             -(hk_CO2+hform_CO2)/0.044*rates[3]-(hk_H2O+hform_H2O)/0.018*rates[4];

  rates[5] /= 1300;

  return rates;
}
